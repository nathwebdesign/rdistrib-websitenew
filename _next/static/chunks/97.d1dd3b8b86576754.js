"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[97],{8097:function(e,t,r){r.r(t),r.d(t,{default:function(){return a}});var o=r(7437),s=r(2265);function a(e){let{value:t,onChange:r,placeholder:a,required:n=!1}=e,[c,l]=(0,s.useState)([]),[u,i]=(0,s.useState)(!1),[p,d]=(0,s.useState)(-1),m=(0,s.useRef)(null),f=(0,s.useRef)(null),g=(0,s.useCallback)(async e=>{if(e.length<3){l([]);return}try{var t;let r=await fetch("https://api-adresse.data.gouv.fr/search/?q=".concat(encodeURIComponent(e),"&type=municipality&limit=5")),o=await r.json();console.log("[CityAutocomplete] R\xe9sultats API:",{query:e,features:o.features,firstResult:null===(t=o.features)||void 0===t?void 0:t[0]}),l(o.features||[])}catch(e){console.error("Erreur lors de la recherche de villes:",e),l([])}},[]),y=(0,s.useCallback)(e=>{let t=e.target.value;r(t,void 0),i(!0),d(-1),m.current&&clearTimeout(m.current),m.current=setTimeout(()=>{g(t)},300)},[r,g]),h=(0,s.useCallback)(e=>{let t=e.properties.city||e.properties.label,o=e.properties.postcode,s=o?"".concat(t," ").concat(o):t,a=[e.geometry.coordinates[1],e.geometry.coordinates[0]];console.log("[CityAutocomplete] Suggestion s\xe9lectionn\xe9e:",{city:t,postcode:o,labelWithPostcode:s,suggestion:e,geometryCoordinates:e.geometry.coordinates,coordinates:a,lambert93:{x:e.properties.x,y:e.properties.y}}),r(s,a),l([]),i(!1)},[r]),b=(0,s.useCallback)(e=>{if(u&&0!==c.length)switch(e.key){case"ArrowDown":e.preventDefault(),d(e=>e<c.length-1?e+1:0);break;case"ArrowUp":e.preventDefault(),d(e=>e>0?e-1:c.length-1);break;case"Enter":e.preventDefault(),p>=0&&h(c[p]);break;case"Escape":i(!1)}},[u,c,p,h]);return(0,s.useEffect)(()=>{let e=e=>{f.current&&!f.current.contains(e.target)&&i(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,o.jsxs)("div",{className:"relative",ref:f,children:[(0,o.jsx)("input",{type:"text",value:t,onChange:y,onKeyDown:b,onFocus:()=>i(!0),placeholder:a,className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary",required:n}),u&&c.length>0&&(0,o.jsx)("div",{className:"absolute z-10 mt-1 w-full rounded-md bg-white shadow-lg border border-gray-200",children:c.map((e,t)=>(0,o.jsxs)("div",{className:"px-3 py-2 cursor-pointer hover:bg-gray-100 ".concat(t===p?"bg-gray-100":""),onClick:()=>h(e),children:[(0,o.jsx)("p",{className:"text-sm text-gray-900 font-medium",children:e.properties.city||e.properties.label}),e.properties.postcode&&(0,o.jsx)("p",{className:"text-xs text-gray-500",children:e.properties.postcode})]},t))})]})}}}]);